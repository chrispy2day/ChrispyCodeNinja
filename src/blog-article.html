<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="shared-styles.html">
<script type="text/javascript" src="../bower_components/moment/min/moment.min.js"></script>

<dom-module id="blog-article">

  <template>

    <style include="shared-styles">
      :host {
        display: block;
        padding: 10px;
      }
    </style>

    <app-location route="{{route}}"></app-location>
    <app-route
      route="{{route}}"
      pattern="/blog-article/:articleSlug"
      data="{{routeData}}"></app-route>

    <iron-ajax
        id="requestor"
        auto
        url="/src/blog/blog.json"
        handle-as="json"
        on-response="handleCall"
        debounce-duration="300"></iron-ajax>

    <div class="card">
      <article>
        <h1>[[post.title]]</h1>
        <element inner-h-t-m-l="[[post.body]]"></element>
      </article>
    </div>
    
  </template>

  <script>

    Polymer({
      is: 'blog-article',
      properties: {
        posts: {
          type: Array,
          notify: true,
          value: function () { return []; } // Default value
        },
        post: {
          type: Object,
          value: null // Default value
        }
      },
      observers: [
        'setMatchingPost(posts, routeData.articleSlug)'
      ],
      _routeChanged: function(changeRecord) {
        this.setMatchingPost();
      },
      handleCall: function() {
        var res = this.$.requestor.lastResponse;
        //console.log(res);
        var _self = this;
        _self.posts = res.posts;
      },
      setMatchingPost: function (posts, slug) {
         console.log('trying to match post ' + slug);
       
        // try and match the slug
        for (var i = 0; i < posts.length; i++) {
          if (slug == posts[i].slug) {
            this.post = posts[i];
            break;
          }
        }
      },
      friendlyDate: function (dateString) {
        return moment(dateString).format('YYYY-MM-DD')
      }
    });

  </script>

</dom-module>
