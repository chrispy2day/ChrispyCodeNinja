<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="shared-styles.html">
<!--<script type="text/javascript" src="../node_modules/jquery/dist/jquery.slim.min.js"></script>-->

<dom-module id="blog-summary">
  <template>
      <style include="shared-styles">
      :host {
        display: block;
        padding: 10px;
      }
    </style>

      <iron-ajax
        id="requestor"
        auto
        url="/src/blog/blog.json"
        handle-as="json"
        on-response="handleCall"
        debounce-duration="300"></iron-ajax>

    <section>
      <template is="dom-repeat" items="[[posts]]" as="post">
        <div class="card">
          <article>
            <h1>[[post.title]]</h1>
            <p><small>By [[post.author]]</small></p>
            <p>[[post.description]]</p>
          </article>
        </div>
      </template>
    </section>

  </template>
      <!--<script
        src="https://code.jquery.com/jquery-3.1.0.slim.min.js"   
        integrity="sha256-cRpWjoSOw5KcyIOaZNo4i6fZ9tKPhYYb6i5T9RSVJG8="   
        crossorigin="anonymous"></script>-->

  <script>
    Polymer({
      is: 'blog-summary',
      properties: {
        posts: {
          type: Array,
          notify: true,
          value: function () { return []; } // Default value
        }
      },
      handleCall: function() {
        var res = this.$.requestor.lastResponse;
        console.log(res);
        var _self = this;
        Object.keys(res).forEach(function(key) {
            _self.push('posts', res[key]);
        });
      }
      /*ready: function() {
        var _self = this;
        $.get('/src/blog/blog.json',function(data){
            _self.posts = $.parseJSON(data).results;
            });
        }*/
    });

  </script>
</dom-module>